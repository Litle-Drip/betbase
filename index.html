<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>The Juice â€” Crypto Escrow Bets</title>
  <style>
  :root{--bg:#0b1220;--card:#0f172a;--text:#e5e7eb;--muted:#94a3b8;--border:#1f2a44;--accent:#22c55e;}
  *{box-sizing:border-box} body{margin:0;background:linear-gradient(180deg,#0b1220,#0a0f1a);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--text)}
  .container{max-width:1200px;margin:20px auto;padding:0 16px}
  .header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
  h1{font-size:26px;margin:0} .brand{display:flex;align-items:center;gap:10px} .brand span.logo{font-size:26px}
  .pill{background:#052e16;border:1px solid #16a34a;color:#86efac;padding:4px 10px;border-radius:999px;font-size:12px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:18px;box-shadow:0 6px 18px rgba(0,0,0,.25);height:100%;}
  .grid{display:grid;gap:14px} @media(min-width:900px){.grid-2{grid-template-columns:repeat(3,minmax(0,1fr))}}
  .label{font-size:13px;color:var(--muted)}
  .input{width:100%;padding:10px;border:1px solid var(--border);border-radius:12px;background:#0b1324;color:var(--text)}
  .btn{padding:9px 13px;border:1px solid var(--accent);background:#0b1324;border-radius:12px;color:#d1fae5;cursor:pointer;transition:transform .06s ease, box-shadow .12s ease} .btn:hover{transform:translateY(-1px);box-shadow:0 6px 16px rgba(0,0,0,.25)}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .small{font-size:12px;color:var(--muted)}
  #qrBox{border:1px dashed var(--border);border-radius:10px;padding:10px;background:#0b1324;display:inline-flex;align-items:center;justify-content:center;min-width:136px;min-height:136px}
  .primary{background:#16a34a;border-color:#16a34a;color:#052e16} .primary:hover{filter:brightness(1.05)}
  .stickybar{position:sticky;bottom:0;z-index:50;background:rgba(11,19,36,.9);backdrop-filter:blur(6px);border:1px solid var(--border);border-radius:14px;margin-top:14px;padding:12px}
  .stickygrid{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between}
  .chip{background:#0b1324;border:1px solid var(--border);border-radius:999px;padding:5px 12px;font-size:12px;color:#cbd5e1}
    /* Equal-height vote cards + clearer titles */
  .voteGrid{grid-template-columns:1fr 1fr;gap:12px;align-items:stretch;grid-auto-rows:1fr}
  .voteCard{display:flex;flex-direction:column;height:100%}
  .voteTitle{font-size:14px;font-weight:600;color:#e2e8f0;letter-spacing:.2px;margin-bottom:4px}
</style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="brand"><span class="logo">ðŸ§ƒ</span><h1>The Juice â€” Crypto Escrow Bets</h1></div>
      <div class="pill">Skill bets â€¢ instant escrow â€¢ fee snapshot</div>
    </div>
    <p class="small">Create a bet, your friend joins and matches the stake, you both confirm the winner, and payout happens. Refunds are feeâ€‘free.</p>

    <div class="grid grid-2">
      <!-- Create Bet -->
      <div class="card">
        <h3>Create Bet</h3>
        <div class="row">
          <div><label class="label">Stake (ETH)</label><input id="stake" class="input" type="number" step="0.0001" value="0.05" style="width:140px"/></div>
          <div><label class="label">Stake (USD)</label><input id="stakeUsdInput" class="input" type="number" step="1" value="175" style="width:140px"/></div>
          <div class="row" style="gap:6px;align-items:flex-end"><button id="stakeMinus" class="btn" title="Decrease">âˆ’</button><button id="stakePlus" class="btn" title="Increase">+</button></div>
        </div>
        <div class="row small"><span style="opacity:.9">Set by USD:</span><button class="btn" id="q1">$1</button><button class="btn" id="q5">$5</button><button class="btn" id="q20">$20</button><span style="margin-left:8px">Custom</span><input id="qCustomUsd" class="input" type="number" min="0" step="1" value="10" style="width:100px"/></div>
        <div id="stakeUsd" class="small">â‰ˆ $0.00</div>

        <div style="height:10px"></div>
        <label class="label">Referee (optional)</label>
        <input id="referee" class="input" placeholder="Referee address (0x...) or leave blank"/>
        <div class="small"><strong>Referee</strong> = a trusted third person who can decide the winner <em>after the deadline</em> if players donâ€™t agree. Blank = both players must confirm the same winner.</div>

        <div style="height:10px"></div>
        <label class="label">Deadline (minutes)</label>
        <input id="deadline" class="input" type="number" value="30"/>

        <div style="height:10px"></div>
        <div class="row"><button id="btnCreate" class="btn primary">Create & Fund</button><button id="btnReset" class="btn">Reset demo</button></div>

        <div style="margin-top:10px" class="small">
          <div>Gas est: ~<span id="gasLimit">80000</span> gas @ <span id="gasGweiVal">5</span> gwei â‰ˆ <span id="gasEth">0</span> ETH (<span id="gasUsd">$0.00</span>)</div>
          <div class="row" style="margin-top:8px">
            <label class="label">ETH/USD</label><input id="ethUsd" type="number" class="input" style="width:120px" value="3500"/>
            <label class="label">Gas (gwei)</label><input id="gasGwei" type="number" class="input" style="width:120px" value="5"/>
          </div>
        </div>
      </div>

      <!-- Middle column -->
      <div class="grid" style="gap:14px">
        <div class="card">
          <h3>Join / Resolve</h3>
          <div class="small" id="resolveNote" style="margin-top:4px;opacity:.9">Waiting for both votesâ€¦</div>
          <div class="row" style="margin:10px 0">
            <button id="btnJoin" class="btn">Join & Match Stake</button>
            <button id="btnRefund" class="btn">Request Refund</button>
          </div>
          <div class="grid voteGrid">
            <div class="card voteCard" style="padding:10px">
              <div class="voteTitle">Creator vote</div>
              <div class="row" style="margin-top:6px">
                <button id="creatorWon" class="btn">Creator won</button>
                <button id="creatorSaysOpponent" class="btn">Opponent won</button>
              </div>
            </div>
            <div class="card voteCard" style="padding:10px">
              <div class="voteTitle">Opponent vote</div>
              <div class="row" style="margin-top:6px">
                <button id="opponentSaysCreator" class="btn">Creator won</button>
                <button id="opponentWon" class="btn">Opponent won</button>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <h3>Bet Ideas</h3>
          <div class="small">Tap shuffle to get a quick, fair challenge idea you can use IRL.</div>
          <div class="row" style="margin-top:8px">
            <input id="ideaBox" class="input" readonly value="Make a 3-point shot from the top of the key"/>
            <button id="ideaShuffle" class="btn">Shuffle</button>
          </div>
          <div class="small" style="margin-top:8px">Examples: darts double-out, cornhole 2â€‘inâ€‘aâ€‘row, bottle flip 3/5, crossbar challenge, closestâ€‘toâ€‘theâ€‘pin (mini golf), pool: bank shot in 2 tries.</div>
        </div>
      </div>

      <!-- Right: Share / QR -->
      <div class="card">
        <h3>Share / QR</h3>
        <div class="small">Show this to your opponent so they can open the exact bet.</div>
        <div class="row" style="margin-top:8px">
          <input id="betId" class="input" style="width:140px" value="1"/>
          <input id="shareUrl" class="input" readonly/>
          <button id="copyBtn" class="btn">Copy link</button>
        </div>
        <div id="qrBox" style="margin-top:10px"></div>
      </div>
    </div>

    <!-- Sticky summary -->
    <div class="stickybar">
      <div class="stickygrid">
        <div class="chip">State: <strong id="sbState">Created</strong></div>
        <div class="chip">Fee: <strong><span id="sbFee">2.5</span>%</strong></div>
        <div class="chip">Pot: <strong><span id="sbPotEth">0.0000</span> ETH</strong> (<span id="sbPotUsd">$0.00</span>)</div>
        <div class="chip">Winner gets: <strong><span id="sbWinEth">0.0000</span> ETH</strong> (<span id="sbWinUsd">$0.00</span>)</div>
      </div>
    </div>
  </div>
  <script>
    // Minimal QR init that keeps your existing structure intact
    document.addEventListener('DOMContentLoaded', () => {
      const betIdEl = document.getElementById('betId');
      const shareEl = document.getElementById('shareUrl');
      const qrBox = document.getElementById('qrBox');

      function makeUrl() {
        try {
          const url = new URL(window.location.href);
          if (betIdEl && betIdEl.value) url.searchParams.set('bet', String(betIdEl.value).trim());
          return url.toString();
        } catch (_) {
          return window.location.href;
        }
      }

      // Populate share URL if empty
      if (shareEl && !shareEl.value) shareEl.value = makeUrl();

      function renderQR() {
        if (!qrBox) return;
        qrBox.innerHTML = '';
        try {
          new QRCode(qrBox, {
            text: (shareEl && shareEl.value) ? shareEl.value : makeUrl(),
            width: 140,
            height: 140,
            colorDark: '#ffffff',
            colorLight: '#0b1324',
            correctLevel: QRCode.CorrectLevel.M,
          });
        } catch (e) {
          console.error('QR render error:', e);
        }
      }

      renderQR();

      // Live updates when fields change
      if (betIdEl) betIdEl.addEventListener('input', () => { if (shareEl) shareEl.value = makeUrl(); renderQR(); });
      if (shareEl) shareEl.addEventListener('input', renderQR);

      // Copy button behavior (no UI change)
      const copyBtn = document.getElementById('copyBtn');
      if (copyBtn && shareEl) {
        copyBtn.addEventListener('click', async () => {
          try { await navigator.clipboard.writeText(shareEl.value); } catch (_) {}
        });
      }
    });
  </script>
</body>
</html>
