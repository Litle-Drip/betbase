<script>
// ===== CONFIG =====
const BASE = { idHex:'0x14a34', rpc:'https://sepolia.base.org', explorer:'https://sepolia.basescan.org' };
const FEE_BPS = 250;                  // locked 2.5%
let   ETH_USD = 3500;                 // preview only (can be replaced later)
const CONTRACT_ADDRESS = (document.getElementById('contractAddress')?.value || '').trim();

// ===== Helpers (UI) =====
function $(id){ return document.getElementById(id); }
function setState(text){
  const el = $('sbState'); if (!el) return;
  el.textContent = text;
  el.classList.add('state-chip');
  if (text.startsWith('Connected')) el.classList.add('state-ok');
}
function updatePreview(){
  const stakeEth = parseFloat($('stake').value || '0') || 0;
  const pot = stakeEth * 2;
  const win = pot * (1 - FEE_BPS/10000);
  $('sbPotEth').textContent = pot.toFixed(4);
  $('sbPotUsd').textContent = `$${(pot*ETH_USD).toFixed(2)}`;
  $('sbWinEth').textContent = win.toFixed(4);
  $('sbWinUsd').textContent = `$${(win*ETH_USD).toFixed(2)}`;
}

// keep Stake â†” USD in sync
function syncUsdFromEth(){
  const v = parseFloat($('stake').value||'0'); $('stakeUsdInput').value = (v*ETH_USD).toFixed(0); updatePreview();
}
function syncEthFromUsd(){
  const v = parseFloat($('stakeUsdInput').value||'0'); $('stake').value = (v/ETH_USD).toFixed(4); updatePreview();
}

// ===== QR/share (unchanged layout) =====
(function initQR(){
  const betIdEl = $('betId'), shareEl = $('shareUrl'), qrBox = $('qrBox');
  function makeUrl(){
    try{ const url = new URL(window.location.href);
      if (betIdEl.value) url.searchParams.set('bet', String(betIdEl.value).trim());
      return url.toString();
    }catch(_){ return window.location.href; }
  }
  if (shareEl && !shareEl.value) shareEl.value = makeUrl();
  function renderQR(){
    if (!qrBox) return; qrBox.innerHTML='';
    try{ new QRCode(qrBox,{ text: (shareEl?.value)||makeUrl(), width:140, height:140,
      colorDark:'#ffffff', colorLight:'#0b1324', correctLevel: QRCode.CorrectLevel.M }); }catch(_){}
  }
  // fill Bet ID from ?bet= on page open (for the joiner)
  (function initBetFromUrl(){
    const p = new URLSearchParams(location.search); const id = p.get('bet');
    if (id){ if (betIdEl) betIdEl.value = id; }
  })();
  renderQR();
  betIdEl?.addEventListener('input', ()=>{ if (shareEl) shareEl.value = makeUrl(); renderQR(); });
  shareEl?.addEventListener('input', renderQR);
  $('copyBtn')?.addEventListener('click', async()=>{ try{ await navigator.clipboard.writeText(shareEl.value); }catch(_){ } });
})();

// ===== Ethers / Wallet =====
let provider, signer;
async function ensure
