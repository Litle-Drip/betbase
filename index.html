<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ðŸ’° TheJuice â€” Crypto Escrow Bets (Pro)</title>
  <style>
  :root{--bg:#0b1220;--card:#0f172a;--text:#e5e7eb;--muted:#94a3b8;--border:#1f2a44;--accent:#22c55e;}
  *{box-sizing:border-box} body{margin:0;background:linear-gradient(180deg,#0b1220,#0a0f1a);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--text)}
  .container{max-width:1200px;margin:12px auto;padding:0 12px}
  .header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
  h1{font-size:24px;margin:0} .brand{display:flex;align-items:center;gap:10px} .brand span.logo{font-size:26px}
  .pill{background:#052e16;border:1px solid #16a34a;color:#86efac;padding:3px 8px;border-radius:999px;font-size:11px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:14px;box-shadow:0 6px 18px rgba(0,0,0,.25)}
  .grid{display:grid;gap:10px} @media(min-width:900px){.grid-2{grid-template-columns:1.6fr 1.6fr 1.2fr}}
  .label{font-size:13px;color:var(--muted)}
  .input{width:100%;padding:10px;border:1px solid var(--border);border-radius:12px;background:#0b1324;color:var(--text)}
  .btn{padding:8px 12px;border:1px solid var(--accent);background:#0b1324;border-radius:12px;color:#d1fae5;cursor:pointer;transition:transform .06s ease, box-shadow .12s ease} .btn:hover{transform:translateY(-1px);box-shadow:0 6px 16px rgba(0,0,0,.25)}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .small{font-size:12px;color:var(--muted)}
  #qrBox{border:1px dashed var(--border);border-radius:10px;padding:8px;background:#0b1324;display:inline-flex;align-items:center;justify-content:center;min-width:136px;min-height:136px}
  .primary{background:#16a34a;border-color:#16a34a;color:#052e16} .primary:hover{filter:brightness(1.05)}
  .stickybar{position:sticky;bottom:0;z-index:50;background:rgba(11,19,36,.9);backdrop-filter:blur(6px);border:1px solid var(--border);border-radius:12px;margin-top:10px;padding:10px}
  .stickygrid{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between}
  .chip{background:#0b1324;border:1px solid var(--border);border-radius:999px;padding:4px 10px;font-size:12px;color:#cbd5e1}
  </style>
  <!-- Stable QR library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="brand"><span class="logo">ðŸ’°</span><h1>BetBase â€” Crypto Escrow Bets</h1></div>
      <div class="pill">Skill bets â€¢ instant escrow â€¢ fee snapshot</div>
    </div>
    <p class="small">Create a bet, your friend joins and matches the stake, you both confirm the winner, and payout happens. Refunds are fee-free.</p>

    <div class="grid grid-2">
      <!-- Create Bet -->
      <div class="card">
        <h3>Create Bet</h3>
        <div class="row">
          <div><label class="label">Stake (ETH)</label><input id="stake" class="input" type="number" step="0.0001" value="0.05" style="width:140px"/></div>
          <div><label class="label">Stake (USD)</label><input id="stakeUsdInput" class="input" type="number" step="1" value="175" style="width:140px"/></div>
          <div class="row" style="gap:6px;align-items:flex-end"><button id="stakeMinus" class="btn" title="Decrease">âˆ’</button><button id="stakePlus" class="btn" title="Increase">+</button></div>
        </div>
        <div class="row small"><span style="opacity:.9">Set by USD:</span><button class="btn" id="q1">$1</button><button class="btn" id="q5">$5</button><button class="btn" id="q20">$20</button><span style="margin-left:8px">Custom</span><input id="qCustomUsd" class="input" type="number" min="0" step="1" value="10" style="width:100px"/></div>
        <div id="stakeUsd" class="small">â‰ˆ $0.00</div>

        <div style="height:8px"></div>
        <label class="label">Referee (optional)</label>
        <input id="referee" class="input" placeholder="Referee address (0x...) or leave blank"/>
        <div class="small"><strong>Referee</strong> = a trusted third person who can decide the winner <em>after the deadline</em> if players donâ€™t agree. Blank = both players must confirm the same winner.</div>

        <div style="height:8px"></div>
        <label class="label">Deadline (minutes)</label>
        <input id="deadline" class="input" type="number" value="30"/>

        <div style="height:8px"></div>
        <div class="row"><button id="btnCreate" class="btn primary">Create & Fund</button><button id="btnReset" class="btn">Reset demo</button></div>

        <div style="margin-top:8px" class="small">
          <div>Gas est: ~<span id="gasLimit">80000</span> gas @ <span id="gasGweiVal">5</span> gwei â‰ˆ <span id="gasEth">0</span> ETH (<span id="gasUsd">$0.00</span>)</div>
          <div class="row" style="margin-top:6px">
            <label class="label">ETH/USD</label><input id="ethUsd" type="number" class="input" style="width:120px" value="3500"/>
            <label class="label">Gas (gwei)</label><input id="gasGwei" type="number" class="input" style="width:120px" value="5"/>
          </div>
        </div>
      </div>

      <!-- Middle column: Join/Resolve + Ideas -->
      <div class="grid" style="gap:10px">
        <div class="card">
          <h3>Join / Resolve</h3>
          <div class="small" id="resolveNote" style="margin-top:4px;opacity:.9">Waiting for both votesâ€¦</div>
          <div class="row" style="margin:8px 0">
            <button id="btnJoin" class="btn">Join & Match Stake</button>
            <button id="btnRefund" class="btn">Request Refund</button>
          </div>
          <div class="grid" style="grid-template-columns:1fr 1fr; gap:10px">
            <div class="card" style="padding:10px">
              <div class="small">Creator vote</div>
              <div class="row" style="margin-top:6px">
                <button id="creatorWon" class="btn">Creator won</button>
                <button id="creatorSaysOpponent" class="btn">Opponent won</button>
              </div>
            </div>
            <div class="card" style="padding:10px">
              <div class="small">Opponent vote</div>
              <div class="row" style="margin-top:6px">
                <button id="opponentSaysCreator" class="btn">Creator won</button>
                <button id="opponentWon" class="btn">Opponent won</button>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <h3>Bet Ideas</h3>
          <div class="small">Tap shuffle to get a quick, fair challenge idea you can use IRL.</div>
          <div class="row" style="margin-top:6px">
            <input id="ideaBox" class="input" readonly value="Make a 3-point shot from the top of the key"/>
            <button id="ideaShuffle" class="btn">Shuffle</button>
          </div>
          <div class="small" style="margin-top:6px">Examples: darts double-out, cornhole 2-in-a-row, bottle flip 3/5, crossbar challenge, closest-to-the-pin (mini golf), pool: bank shot in 2 tries.</div>
        </div>
      </div>

      <!-- Right: Share / QR -->
      <div class="card">
        <h3>Share / QR</h3>
        <div class="small">Show this to your opponent so they can open the exact bet.</div>
        <div class="row" style="margin-top:6px">
          <input id="betId" class="input" style="width:140px" value="1"/>
          <input id="shareUrl" class="input" readonly/>
          <button id="copyBtn" class="btn">Copy link</button>
        </div>
        <div id="qrBox" style="margin-top:8px"></div>
      </div>
    </div>

    <!-- Sticky summary -->
    <div class="stickybar">
      <div class="stickygrid">
        <div class="chip">State: <strong id="sbState">Created</strong></div>
        <div class="chip">Fee: <strong><span id="sbFee">2.5</span>%</strong></div>
        <div class="chip">Pot: <strong><span id="sbPotEth">0.0000</span> ETH</strong> (<span id="sbPotUsd">$0.00</span>)</div>
        <div class="chip">Winner gets: <strong><span id="sbWinEth">0.0000</span> ETH</strong> (<span id="sbWinUsd">$0.00</span>)</div>
      </div>
    </div>
  </div>

<script>
window.addEventListener('DOMContentLoaded', function(){
  const MIN_FEE_BPS = 250; let feeBps = MIN_FEE_BPS;
  let state = 'Created'; let creatorVote=null, opponentVote=null, winner=null;
  let stakeEth = 0.05, gasGwei = 5, gasLimit = 80000, ethUsd = 3500;

  const el = (id)=>document.getElementById(id);
  const fmtUsd = (n)=> '$' + n.toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2});
  const fmtEth = (n)=> (Math.round(n*10000)/10000).toFixed(4);

  const stakeInput = el('stake'); const stakeUsdInput = el('stakeUsdInput');
  const ethUsdInput = el('ethUsd'); const gasGweiInput = el('gasGwei');
  const betIdInput = el('betId'); const shareUrlInput = el('shareUrl'); const qrContainer = el('qrBox');
  const stakeUsdOut = el('stakeUsd'); const gasLimitOut = el('gasLimit'); const gasGweiVal = el('gasGweiVal');
  const gasEthOut = el('gasEth'); const gasUsdOut = el('gasUsd');
  const sbState=el('sbState'), sbFee=el('sbFee'), sbPotEth=el('sbPotEth'), sbPotUsd=el('sbPotUsd'), sbWinEth=el('sbWinEth'), sbWinUsd=el('sbWinUsd');
  const resolveNote = el('resolveNote');
  const btnCreate = el('btnCreate'); const btnJoin = el('btnJoin'); const btnRefund = el('btnRefund'); const btnReset = el('btnReset');
  const creatorWonBtn = el('creatorWon'); const creatorOppBtn = el('creatorSaysOpponent');
  const oppCreatorBtn = el('opponentSaysCreator'); const oppWonBtn = el('opponentWon'); const copyBtn = el('copyBtn');

  let qrcode = null;
  if (qrContainer && window.QRCode) { qrcode = new QRCode(qrContainer, { width: 128, height: 128, text: '' }); }

  function pot(){ return stakeEth * 2; }
  function feeEth(){ return pot() * (feeBps/10000); }
  function winnerEth(){ return Math.max(0, pot() - feeEth()); }
  function gasEthCalc(){ return (gasLimit*(gasGwei*1e9))/1e18; }
  function shareBase(){ return 'https://litle-drip.github.io/betbase/?bet='; }

  function updateNumbers(){
    if (stakeUsdOut) stakeUsdOut.textContent = 'â‰ˆ ' + fmtUsd(stakeEth*ethUsd);
    if (gasLimitOut) gasLimitOut.textContent = gasLimit.toLocaleString();
    if (gasGweiVal) gasGweiVal.textContent = String(gasGwei);
    if (gasEthOut) gasEthOut.textContent = gasEthCalc().toFixed(6);
    if (gasUsdOut) gasUsdOut.textContent = fmtUsd(gasEthCalc()*ethUsd);
    const url = shareBase() + encodeURIComponent(betIdInput.value || '1');
    if (shareUrlInput) shareUrlInput.value = url;
    if (qrcode) qrcode.makeCode(url);
    sbState.textContent = state; sbFee.textContent=(feeBps/100).toString();
    sbPotEth.textContent=fmtEth(pot()); sbPotUsd.textContent=fmtUsd(pot()*ethUsd);
    sbWinEth.textContent=fmtEth(winnerEth()); sbWinUsd.textContent=fmtUsd(winnerEth()*ethUsd);
  }

  function resetForCreated(){ state='Created'; creatorVote=opponentVote=winner=null; if(resolveNote) resolveNote.textContent='Waiting for both votesâ€¦'; }

  // Inputs
  stakeInput.oninput = ()=>{ const n=parseFloat(stakeInput.value||'0'); stakeEth = Number.isFinite(n)&&n>0?n:0; if(stakeUsdInput) stakeUsdInput.value=Math.round(stakeEth*ethUsd); updateNumbers(); };
  stakeUsdInput.oninput = ()=>{ const u=parseFloat(stakeUsdInput.value||'0'); const eth = Number.isFinite(u)&&u>0 ? (u/Math.max(1,ethUsd)) : 0; stakeInput.value = eth.toFixed(4); stakeInput.dispatchEvent(new Event('input')); };
  const stakeMinus = document.getElementById('stakeMinus'); const stakePlus  = document.getElementById('stakePlus');
  stakeMinus.onclick = ()=>{ const n=parseFloat(stakeInput.value||'0')||0; const v=Math.max(0, (n-0.01)); stakeInput.value = v.toFixed(2); stakeInput.dispatchEvent(new Event('input')); };
  stakePlus.onclick  = ()=>{ const n=parseFloat(stakeInput.value||'0')||0; const v=n+0.01; stakeInput.value = v.toFixed(2); stakeInput.dispatchEvent(new Event('input')); };

  ethUsdInput.oninput = ()=>{ const n=parseFloat(ethUsdInput.value||'0'); ethUsd=Number.isFinite(n)&&n>0?n:0; stakeInput.dispatchEvent(new Event('input')); };
  gasGweiInput.oninput = ()=>{ const n=parseFloat(gasGweiInput.value||'0'); gasGwei=Number.isFinite(n)&&n>0?n:0; updateNumbers(); };
  const toEth = (usd)=> (usd / Math.max(1, ethUsd));
  const q1  = document.getElementById('q1'); const q5  = document.getElementById('q5'); const q20 = document.getElementById('q20'); const qCustomUsd = document.getElementById('qCustomUsd');
  q1.onclick  = ()=>{ stakeInput.value = toEth(1).toFixed(4); stakeInput.dispatchEvent(new Event('input')); };
  q5.onclick  = ()=>{ stakeInput.value = toEth(5).toFixed(4); stakeInput.dispatchEvent(new Event('input')); };
  q20.onclick = ()=>{ stakeInput.value = toEth(20).toFixed(4); stakeInput.dispatchEvent(new Event('input')); };
  qCustomUsd.oninput = ()=>{ const usd = parseFloat(qCustomUsd.value||'0'); if (!Number.isFinite(usd) || usd <= 0) return; stakeInput.value = toEth(usd).toFixed(4); stakeInput.dispatchEvent(new Event('input')); };
  betIdInput.oninput = updateNumbers;

  // Actions
  btnCreate.onclick = ()=>{ const n=parseFloat(stakeInput.value||'0'); if(!Number.isFinite(n)||n<=0){alert('Enter a valid stake');return;} feeBps=Math.max(feeBps,MIN_FEE_BPS); resetForCreated(); state='Created'; updateNumbers(); alert('Bet created. Share the QR or link and have your friend click Join.'); };
  btnJoin.onclick = ()=>{ if(state!=='Created'){alert('Already joined.');return;} state='Funded'; updateNumbers(); };
  function tryResolve(){ if(creatorVote && opponentVote && creatorVote===opponentVote){ winner=creatorVote; state='Resolved'; if(resolveNote) resolveNote.textContent = (winner==='creator'?'Creator':'Opponent') + ' confirmed â€” ready to payout'; updateNumbers(); alert('Resolved: '+(winner==='creator'?'Creator':'Opponent')+' wins.'); } }
  creatorWonBtn.onclick = ()=>{ if(state==='Funded'){ creatorVote='creator'; tryResolve(); } };
  creatorOppBtn.onclick = ()=>{ if(state==='Funded'){ creatorVote='opponent'; tryResolve(); } };
  oppCreatorBtn.onclick = ()=>{ if(state==='Funded'){ opponentVote='creator'; tryResolve(); } };
  oppWonBtn.onclick = ()=>{ if(state==='Funded'){ opponentVote='opponent'; tryResolve(); } };
  btnRefund.onclick = ()=>{ if(state==='Resolved'){ alert('Already resolved.'); return; } state='Refunded'; updateNumbers(); alert('Refund: each side withdraws their stake. No protocol fee.'); };
  copyBtn.onclick = async ()=>{ try{ await navigator.clipboard.writeText(shareUrlInput.value||window.location.href); copyBtn.textContent='Copied!'; setTimeout(()=>copyBtn.textContent='Copy link',1200);}catch(e){ alert('Copy failed: '+e);} };

  btnReset.onclick = ()=>{ stakeInput.value='0.05'; stakeInput.dispatchEvent(new Event('input')); betIdInput.value='1'; creatorVote=null; opponentVote=null; winner=null; feeBps=250; state='Created'; if(resolveNote) resolveNote.textContent='Waiting for both votesâ€¦'; updateNumbers(); window.scrollTo({top:0,behavior:'smooth'}); };

  // Bet ideas
  const ideas = [
    "Make a 3-point shot from the top of the key",
    "Darts: land a double within 3 throws",
    "Cornhole: 2 bags on board in 3 tosses",
    "Bottle flip: 3 successes out of 5",
    "Soccer: hit the crossbar in 3 shots",
    "Mini golf: closest to the hole from 15ft",
    "Pool: sink a bank shot in 2 tries",
    "Ping pong: hit corner target in 3 serves",
    "Frisbee: 20-yard toss into hoop in 3 tries"
  ];
  const ideaBox = document.getElementById('ideaBox'); const ideaShuffle = document.getElementById('ideaShuffle');
  ideaShuffle.onclick = ()=>{ ideaBox.value = ideas[Math.floor(Math.random()*ideas.length)]; };

  // init
  stakeInput.dispatchEvent(new Event('input'));
  updateNumbers();
});
</script>
</body>
</html>
